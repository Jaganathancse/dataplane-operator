---
apiVersion: dataplane.openstack.org/v1beta1
kind: OpenStackDataPlaneNodeSet
metadata:
  labels:
    openstackdataplane: openstack-edpm
  name: edpm-compute
spec:
  deployStrategy:
    deploy: false
  env:
  - name: ANSIBLE_FORCE_COLOR
    value: "True"
  - name: ANSIBLE_ENABLE_TASK_DEBUGGER
    value: "True"
  dataPlane: openstack-edpm-ipam
  services:
    - configure-network
    - validate-network
    - install-os
    - configure-os
    - run-os
    - libvirt
    - nova
  nodeTemplate:
    nodes:
      edpm-compute-0:
        ansible:
          ansibleHost: 172.20.12.67
          ansibleSSHPrivateKeySecret: dataplane-ansible-ssh-private-key-secret
          ansibleUser: root
          ansibleVars:
            ansible_ssh_transfer_method: scp
            ctlplane_ip: 172.20.12.67
            external_ip: 172.20.12.76
            fqdn_internal_api: edpm-compute-1.example.com
            internal_api_ip: 172.17.0.101
            storage_ip: 172.18.0.101
            tenant_ip: 172.10.0.101
        hostName: edpm-compute-0
        networkConfig: {}
        nova:
          cellName: cell1
          deploy: true
          novaInstance: nova
    networkConfig:
      template: |
        ---
        network_config:
        - type: interface
          name: nic2
          mtu: 1500
          addresses:
            - ip_netmask:
                {{ ctlplane_ip }}/{{ ctlplane_subnet_cidr }}
        - type: ovs_bridge
          name: {{ neutron_physical_bridge_name }}
          mtu: 1500
          use_dhcp: false
          dns_servers: {{ ctlplane_dns_nameservers }}
          domain: []
          addresses:
          - ip_netmask: {{ lookup('vars', networks_lower["External"] ~ '_ip') }}/{{ lookup('vars', networks_lower["External"] ~ '_cidr') }}
          routes: [{'ip_netmask': '0.0.0.0/0', 'next_hop': '192.168.1.254'}]
          members:
          - type: interface
            name: nic1
            mtu: 1500
            # force the MAC address of the bridge to this interface
            primary: true
          - type: vlan
            mtu: 1500
            vlan_id: 20
            addresses:
            - ip_netmask:
                172.17.0.101/24
            routes: []
          - type: vlan
            mtu: 1500
            vlan_id: 25
            addresses:
            - ip_netmask:
                172.18.0.101/24
            routes: []
          - type: vlan
            mtu: 1500
            vlan_id: 22
            addresses:
            - ip_netmask:
                172.19.0.101/24
            routes: []
    managed: false
    managementNetwork: ctlplane
    ansible:
      ansibleUser: root
      ansiblePort: 22
status:
  conditions:
  - message: Deployment not started
    reason: NotRequested
    severity: Info
    status: "False"
    type: Ready
  - message: Deployment not started
    reason: NotRequested
    severity: Info
    status: "False"
    type: DeploymentReady
  - message: Input data complete
    reason: Ready
    status: "True"
    type: InputReady
  - message: Setup complete
    reason: Ready
    status: "True"
    type: SetupReady
---
apiVersion: dataplane.openstack.org/v1beta1
kind: OpenStackDataPlane
metadata:
  name: openstack-edpm-ipam
spec:
  deployStrategy:
    deploy: False
  nodeSets:
    - edpm-compute
status:
  conditions:
  - message: Deployment not started
    reason: NotRequested
    severity: Info
    status: "False"
    type: Ready
  - message: Deployment not started
    reason: NotRequested
    severity: Info
    status: "False"
    type: DeploymentReady
  - message: Setup complete
    reason: Ready
    status: "True"
    type: SetupReady
---
apiVersion: v1
kind: Secret
metadata:
  labels:
    openstackdataplane: openstack-edpm
  name: dataplanerole-edpm-compute
data:
  inventory: |
    edpm-compute:
        vars:
            ansible_port: 22
            ansible_user: root
            ctlplane_dns_nameservers:
                - 192.168.122.1
            ctlplane_gateway_ip: 192.168.122.1
            ctlplane_host_routes:
                - ip_netmask: 0.0.0.0/0
                  next_hop: 192.168.122.1
            ctlplane_mtu: 1500
            ctlplane_subnet_cidr: 24
            dns_search_domains: []
            edpm_chrony_ntp_servers:
                - clock.redhat.com
                - clock2.redhat.com
            edpm_iscsid_image: '{{ registry_url }}/openstack-iscsid:{{ image_tag }}'
            edpm_logrotate_crond_image: '{{ registry_url }}/openstack-cron:{{ image_tag }}'
            edpm_network_config_hide_sensitive_logs: false
            edpm_network_config_template: templates/single_nic_vlans/single_nic_vlans.j2
            edpm_nodes_validation_validate_controllers_icmp: false
            edpm_nodes_validation_validate_gateway_icmp: false
            edpm_nova_compute_container_image: '{{ registry_url }}/openstack-nova-compute:{{ image_tag }}'
            edpm_nova_libvirt_container_image: '{{ registry_url }}/openstack-nova-libvirt:{{ image_tag }}'
            edpm_ovn_controller_agent_image: '{{ registry_url }}/openstack-ovn-controller:{{ image_tag }}'
            edpm_ovn_dbs:
                - 192.168.24.1
            edpm_ovn_metadata_agent_DEFAULT_bind_host: 127.0.0.1
            edpm_ovn_metadata_agent_DEFAULT_transport_url: rabbit://default_user@rabbitmq.openstack.svc:5672
            edpm_ovn_metadata_agent_image: '{{ registry_url }}/openstack-neutron-metadata-agent-ovn:{{ image_tag }}'
            edpm_ovn_metadata_agent_metadata_agent_DEFAULT_metadata_proxy_shared_secret: 12345678
            edpm_ovn_metadata_agent_metadata_agent_DEFAULT_nova_metadata_host: 127.0.0.1
            edpm_ovn_metadata_agent_metadata_agent_ovn_ovn_sb_connection: tcp:10.217.5.121:6642
            edpm_selinux_mode: enforcing
            edpm_sshd_allowed_ranges:
                - 192.168.122.0/24
            edpm_sshd_configure_firewall: true
            enable_debug: false
            external_cidr: "24"
            external_host_routes: []
            external_mtu: 1500
            external_vlan_id: 44
            gather_facts: false
            image_tag: current-podified
            internal_api_cidr: "24"
            internal_api_host_routes: []
            internal_api_mtu: 1500
            internal_api_vlan_id: 20
            management_network: ctlplane
            networks_lower:
                External: external
                InternalApi: internal_api
                Storage: storage
                Tenant: tenant
            neutron_physical_bridge_name: br-ex
            neutron_public_interface_name: eth0
            registry_url: quay.io/podified-antelope-centos9
            role_networks:
                - InternalApi
                - Storage
                - Tenant
            service_net_map:
                nova_api_network: internal_api
                nova_libvirt_network: internal_api
            storage_cidr: "24"
            storage_host_routes: []
            storage_mtu: 1500
            storage_vlan_id: 21
            tenant_cidr: "24"
            tenant_host_routes: []
            tenant_mtu: 1500
            tenant_vlan_id: 22
        hosts:
            edpm-compute-0:
                ansible_host: 192.168.111.100
                ctlplane_ip: 192.168.111.100
                fqdn_internal_api: edpm-compute-0.example.com
                internal_api_ip: 172.17.0.100
                storage_ip: 172.18.0.100
                tenant_ip: 172.19.0.100
            edpm-compute-1:
                ansible_host: 192.168.111.101
                ctlplane_ip: 192.168.111.101
                fqdn_internal_api: edpm-compute-1.example.com
                internal_api_ip: 172.17.0.101
                storage_ip: 172.18.0.101
                tenant_ip: 172.19.0.101
---
apiVersion: v1
kind: Secret
metadata:
  labels:
    openstackdataplanerole: edpm-compute
  name: dataplanenode-edpm-compute-0
data:
  inventory: |
    all:
        hosts:
            edpm-compute-0:
                ansible_host: 192.168.122.100
                ansible_port: "22"
                ansible_user: root
                ctlplane_dns_nameservers:
                    - 192.168.122.1
                ctlplane_gateway_ip: 192.168.122.1
                ctlplane_host_routes:
                    - ip_netmask: 0.0.0.0/0
                      next_hop: 192.168.122.1
                ctlplane_ip: 192.168.122.100
                ctlplane_mtu: 1500
                ctlplane_subnet_cidr: 24
                dns_search_domains: []
                edpm_chrony_ntp_servers:
                    - clock.redhat.com
                    - clock2.redhat.com
                edpm_iscsid_image: '{{ registry_url }}/openstack-iscsid:{{ image_tag }}'
                edpm_logrotate_crond_image: '{{ registry_url }}/openstack-cron:{{ image_tag }}'
                edpm_network_config_hide_sensitive_logs: false
                edpm_network_config_template: templates/single_nic_vlans/single_nic_vlans.j2
                edpm_nodes_validation_validate_controllers_icmp: false
                edpm_nodes_validation_validate_gateway_icmp: false
                edpm_nova_compute_container_image: '{{ registry_url }}/openstack-nova-compute:{{ image_tag }}'
                edpm_nova_libvirt_container_image: '{{ registry_url }}/openstack-nova-libvirt:{{ image_tag }}'
                edpm_ovn_controller_agent_image: '{{ registry_url }}/openstack-ovn-controller:{{ image_tag }}'
                edpm_ovn_dbs:
                    - 192.168.24.1
                edpm_ovn_metadata_agent_DEFAULT_bind_host: 127.0.0.1
                edpm_ovn_metadata_agent_DEFAULT_transport_url: rabbit://default_user@rabbitmq.openstack.svc:5672
                edpm_ovn_metadata_agent_image: '{{ registry_url }}/openstack-neutron-metadata-agent-ovn:{{ image_tag }}'
                edpm_ovn_metadata_agent_metadata_agent_DEFAULT_metadata_proxy_shared_secret: 12345678
                edpm_ovn_metadata_agent_metadata_agent_DEFAULT_nova_metadata_host: 127.0.0.1
                edpm_ovn_metadata_agent_metadata_agent_ovn_ovn_sb_connection: tcp:10.217.5.121:6642
                edpm_selinux_mode: enforcing
                edpm_sshd_allowed_ranges:
                    - 192.168.122.0/24
                edpm_sshd_configure_firewall: true
                enable_debug: false
                external_cidr: "24"
                external_host_routes: []
                external_mtu: 1500
                external_vlan_id: 44
                fqdn_internal_api: edpm-compute-0.example.com
                gather_facts: false
                image_tag: current-podified
                internal_api_cidr: "24"
                internal_api_host_routes: []
                internal_api_ip: 172.17.0.100
                internal_api_mtu: 1500
                internal_api_vlan_id: 20
                management_network: ctlplane
                networks: []
                networks_lower:
                    External: external
                    InternalApi: internal_api
                    Storage: storage
                    Tenant: tenant
                neutron_physical_bridge_name: br-ex
                neutron_public_interface_name: eth0
                registry_url: quay.io/podified-antelope-centos9
                role_networks:
                    - InternalApi
                    - Storage
                    - Tenant
                service_net_map:
                    nova_api_network: internal_api
                    nova_libvirt_network: internal_api
                storage_cidr: "24"
                storage_host_routes: []
                storage_ip: 172.18.0.100
                storage_mtu: 1500
                storage_vlan_id: 21
                tenant_cidr: "24"
                tenant_host_routes: []
                tenant_ip: 172.19.0.100
                tenant_mtu: 1500
                tenant_vlan_id: 22
---
apiVersion: v1
kind: Secret
metadata:
  labels:
    openstackdataplanerole: edpm-compute
  name: dataplanenode-edpm-compute-1
data:
  inventory: |
    all:
        hosts:
            edpm-compute-1:
                ansible_host: 192.168.122.101
                ansible_port: "22"
                ansible_user: root
                ctlplane_dns_nameservers:
                    - 192.168.122.1
                ctlplane_gateway_ip: 192.168.122.1
                ctlplane_host_routes:
                    - ip_netmask: 0.0.0.0/0
                      next_hop: 192.168.122.1
                ctlplane_ip: 192.168.122.101
                ctlplane_mtu: 1500
                ctlplane_subnet_cidr: 24
                dns_search_domains: []
                edpm_chrony_ntp_servers:
                    - clock.redhat.com
                    - clock2.redhat.com
                edpm_iscsid_image: '{{ registry_url }}/openstack-iscsid:{{ image_tag }}'
                edpm_logrotate_crond_image: '{{ registry_url }}/openstack-cron:{{ image_tag }}'
                edpm_network_config_hide_sensitive_logs: false
                edpm_network_config_template: templates/single_nic_vlans/single_nic_vlans.j2
                edpm_nodes_validation_validate_controllers_icmp: false
                edpm_nodes_validation_validate_gateway_icmp: false
                edpm_nova_compute_container_image: '{{ registry_url }}/openstack-nova-compute:{{ image_tag }}'
                edpm_nova_libvirt_container_image: '{{ registry_url }}/openstack-nova-libvirt:{{ image_tag }}'
                edpm_ovn_controller_agent_image: '{{ registry_url }}/openstack-ovn-controller:{{ image_tag }}'
                edpm_ovn_dbs:
                    - 192.168.24.1
                edpm_ovn_metadata_agent_DEFAULT_bind_host: 127.0.0.1
                edpm_ovn_metadata_agent_DEFAULT_transport_url: rabbit://default_user@rabbitmq.openstack.svc:5672
                edpm_ovn_metadata_agent_image: '{{ registry_url }}/openstack-neutron-metadata-agent-ovn:{{ image_tag }}'
                edpm_ovn_metadata_agent_metadata_agent_DEFAULT_metadata_proxy_shared_secret: 12345678
                edpm_ovn_metadata_agent_metadata_agent_DEFAULT_nova_metadata_host: 127.0.0.1
                edpm_ovn_metadata_agent_metadata_agent_ovn_ovn_sb_connection: tcp:10.217.5.121:6642
                edpm_selinux_mode: enforcing
                edpm_sshd_allowed_ranges:
                    - 192.168.122.0/24
                edpm_sshd_configure_firewall: true
                enable_debug: false
                external_cidr: "24"
                external_host_routes: []
                external_mtu: 1500
                external_vlan_id: 44
                fqdn_internal_api: edpm-compute-1.example.com
                gather_facts: false
                image_tag: current-podified
                internal_api_cidr: "24"
                internal_api_host_routes: []
                internal_api_ip: 172.17.0.101
                internal_api_mtu: 1500
                internal_api_vlan_id: 20
                management_network: ctlplane
                networks: []
                networks_lower:
                    External: external
                    InternalApi: internal_api
                    Storage: storage
                    Tenant: tenant
                neutron_physical_bridge_name: br-ex
                neutron_public_interface_name: eth0
                registry_url: quay.io/podified-antelope-centos9
                role_networks:
                    - InternalApi
                    - Storage
                    - Tenant
                service_net_map:
                    nova_api_network: internal_api
                    nova_libvirt_network: internal_api
                storage_cidr: "24"
                storage_host_routes: []
                storage_ip: 172.18.0.101
                storage_mtu: 1500
                storage_vlan_id: 21
                tenant_cidr: "24"
                tenant_host_routes: []
                tenant_ip: 172.19.0.101
                tenant_mtu: 1500
                tenant_vlan_id: 22
