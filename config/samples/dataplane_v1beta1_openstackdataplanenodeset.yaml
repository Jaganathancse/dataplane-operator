apiVersion: dataplane.openstack.org/v1beta1
kind: OpenStackDataPlaneNodeSet
metadata:
  name: openstackdataplanenodeset-sample
spec:
  env:
    - name: ANSIBLE_FORCE_COLOR
      value: "True"
    - name: ANSIBLE_ENABLE_TASK_DEBUGGER
      value: "True"
  services:
    - configure-network
    - validate-network
    - install-os
    - configure-os
    - run-os
    - ovn
    - libvirt
    - nova
  nodeTemplate:
    nodes:
      edpm-compute-0:
        ansible:
          ansibleHost: 172.20.12.67
          ansibleSSHPrivateKeySecret: dataplane-ansible-ssh-private-key-secret
          ansibleUser: root
          ansibleVars:
            ansible_ssh_transfer_method: scp
            ctlplane_ip: 172.20.12.67
            external_ip: 172.20.12.76
            fqdn_internal_api: edpm-compute-1.example.com
            internal_api_ip: 172.17.0.101
            storage_ip: 172.18.0.101
            tenant_ip: 172.10.0.101
        hostName: edpm-compute-0
        networkConfig: {}
        nova:
          cellName: cell1
          deploy: true
          novaInstance: nova
    networkConfig:
      template: |
        ---
        network_config:
        - type: interface
          name: nic2
          mtu: 1500
          addresses:
            - ip_netmask:
                {{ ctlplane_ip }}/{{ ctlplane_subnet_cidr }}
        - type: ovs_bridge
          name: {{ neutron_physical_bridge_name }}
          mtu: 1500
          use_dhcp: false
          dns_servers: {{ ctlplane_dns_nameservers }}
          domain: []
          addresses:
          - ip_netmask: {{ lookup('vars', networks_lower["External"] ~ '_ip') }}/{{ lookup('vars', networks_lower["External"] ~ '_cidr') }}
          routes: [{'ip_netmask': '0.0.0.0/0', 'next_hop': '192.168.1.254'}]
          members:
          - type: interface
            name: nic1
            mtu: 1500
            # force the MAC address of the bridge to this interface
            primary: true
          - type: vlan
            mtu: 1500
            vlan_id: 20
            addresses:
            - ip_netmask:
                172.17.0.101/24
            routes: []
          - type: vlan
            mtu: 1500
            vlan_id: 25
            addresses:
            - ip_netmask:
                172.18.0.101/24
            routes: []
          - type: vlan
            mtu: 1500
            vlan_id: 22
            addresses:
            - ip_netmask:
                172.19.0.101/24
            routes: []
    managed: false
    managementNetwork: ctlplane
    ansible:
      ansibleUser: root
      ansiblePort: 22
